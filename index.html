<canvas id="c" width="180" height="40"></canvas><input type="file" id="d" accept="image/*"><script>var P=function(){function t(r){if(O<M.length){for(var n=b[1],e=M[O],a=[],o=I[e[4]],i=e[1];i<e[1]+e[3];i++)for(var f=e[0];f<e[0]+e[2];f++)if(o.hasOwnProperty(f+","+i))var h=v(n[i*m+f]),a=a.a(h,h,h,255);else a=a.a(255,255,255,255);for(n=a,o=M[O][2],e=(180-o)/2,a=(40-n.length/(4*o))/2,s.fillStyle="white",s.fillRect(0,0,180,40),o=s.getImageData(0,0,o,n.length/(4*o)),i=0;i<n.length;i++)o.data[i]=n[i];s.putImageData(o,e,a),O++,setTimeout(t,r,r)}}function r(t,r){var n=t.target.files;if(0<n.length){var e=URL.createObjectURL(n[0]);f(e,function(t,n){if(n>t.length/(4*n)){y=[];for(var a=0;n>a;a++)for(var o=t.length/(4*n)-1;o>=0;o--){var i=4*(o*n+a);y.p(t[i]),y.p(t[i+1]),y.p(t[i+2]),y.p(t[i+3])}m=t.length/(4*n),w=n}else y=t,m=n,w=t.length/(4*n);URL.revokeObjectURL(e),r()})}}function n(t){for(var r=[],n=0;n<t.length;n++)r.p(0);for(var e=[],a=-4;4>=a;a++){e.p([]);for(var o=-4;4>=o;o++)e[a+4].p(.1*Math.exp(-(a*a)/2-o*o/5.12))}for(n=0;n<t.length;n++)if(0===t[n])for(var i=v(n/m),f=n%m,a=l(i-4,0);a<=g(i+4,w-1);a++)for(o=l(f-4,0);o<=g(f+4,m-1);o++)r[a*m+o]+=4*e[a+4-i][o+4-f];for(n=0;n<r.length;n++)r[n]=.65<r[n]?0:1;return r}function e(t){for(var r=[],n=0;n<t.length;n++)r.p(0);for(var e=1,n=0;n<t.length;n++)if(0===r[n]&&1!==t[n]){for(var a=function(n){.5>t[n]&&0===r[n]&&(r[n]=e,o.p(n))},o=[n],i=0;i<o.length;){var f=o[i],h=v(f/m),f=f%m;if(w>h+1){var u=(h+1)*m+f;a(u)}h-1>=0&&(u=(h-1)*m+f,a(u)),f-1>=0&&(u=h*m+f-1,a(u)),m>f+1&&(u=h*m+f+1,a(u)),i++}e++}return r}function a(t,r){var n={};t.r(function(t,e){if(0!==t){var a=e%r,o=v(e/r);n.hasOwnProperty(t)||(n[t]={}),n[t][a+","+o]=!0}});var e,a=[];for(e in n)n.hasOwnProperty(e)&&25<=Object.keys(n[e]).length&&a.p(n[e]);return a}function o(t){return t[1].map(function(r){return r>.75*t[0]?1:0})}function i(t,r,n){for(var e=[],a=0,o=t.length/(4*r),i=0;o>i;i++)for(var f=0;r>f;f++){var h=4*(m*i+f),h=.21*t[h]+.72*t[h+1]+.07*t[h+2];e.p(g(255,v(n*h))),a+=h}return a/=m*w,[a,e]}function f(t,r){var n=new Image;n.onload=function(){var t=document.createElement("canvas");t.width=n.width,t.height=n.height,t.style.display="none",document.body.appendChild(t);var e=t.getContext("2d");e.drawImage(n,0,0,n.width,n.height);var a=e.getImageData(0,0,t.width,t.height).data,o=n.height/n.width*720,e=e.getImageData(0,0,720,o).data,i=t.width/720,f=Math.ceil(i);for(document.body.removeChild(t),t=0;o>t;t++)for(var h=0;720>h;h++){for(var u=4*(h+720*t),c=0,l=0,g=0,d=0,p=0,s=0,m=0,w=(t+.5)*i,y=v(t*i);(t+1)*i>y;y++)for(var b=Math.abs(w-(y+.5))/f,I=(h+.5)*i,b=b*b,M=v(h*i);(h+1)*i>M;M++){var O=Math.abs(I-(M+.5))/f,c=Math.sqrt(b+O*O);c>=-1&&1>=c&&(c=2*c*c*c-3*c*c+1,c>0&&(O=4*(M+y*n.width),m+=c*a[O+3],g+=c,255>a[O+3]&&(c=c*a[O+3]/250),d+=c*a[O],p+=c*a[O+1],s+=c*a[O+2],l+=c))}e[u]=d/l,e[u+1]=p/l,e[u+2]=s/l,e[u+3]=m/g}r(e,720)},n.src=t}function h(t){return t.map(function(t,r){var n=1/0,e=1/0,a=-1/0,o=-1/0;return Object.keys(t).r(function(t){t=t.split(",").map(function(t){return parseInt(t)}),n=g(n,t[0]),e=g(e,t[1]),a=l(a,t[0]),o=l(o,t[1])}),[n,e,a-n,o-e,r]}).q(function(t){return 4<t[2]})}function u(t){for(var r=[];0<t.length;){var n,e=!1;if(0<r.length){var a=r[r.length-1],o=[];t.r(function(t,r){var n=a[1]+a[3]/2,e=t[1]+t[3]/2,n=n>t[1]&&n<t[1]+t[3];(e>a[1]&&e<a[1]+a[3]||n)&&o.p(t.a(r))}),o=o.q(function(t){var r=t[0]+t[2]/2-(a[0]+a[2]/2);return r>0&&r<t[2]+a[2]}).sort(function(t,r){return t[0]+t[2]/2-(r[0]+r[2]/2)}),0<o.length?n=o[0]:e=!0}else e=!0;e&&(n=t.reduce(function(t,r,n){return t[0]+3*t[1]<r[0]+3*r[1]?t:r.a(n)},[1/0,1/0,1/0,1/0,-1])),r.p(t.splice(n[5],1)[0])}return r}function c(t){return"#"!==t.charAt(0)?!1:document.getElementById(t.substring(1))}var v=Math.floor,l=Math.max,g=Math.min,d=Array.prototype;d.p=d.push,d.q=d.filter,d.r=d.forEach,d.a=d.concat;var p,s,m,w,y,b,I,M,O;return{b:function(){p=c("#c"),s=p.getContext("2d"),w=m=0,y=[],b=[],I=[],M=[],O=0,c("#d").addEventListener("change",function(f){w=m=0,y=[],b=[],I=[],M=[],O=0,r(f,function(){var r;r=i(y,m,1),r=o(r),I=a(e(n(n(r))),m),M=u(h(I)),b=i(y,m,1.6),t(150)})})}}}();window.addEventListener("load",P.b);</script>
