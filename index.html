<canvas id="c" width="180" height="40"></canvas><input type="file" id="d" accept="image/*"><script>7=parseInt;O=function(){function t(r){if(M<O.length){for(var n=b[1],e=O[M],a=[],o=I[e[4]],i=e[1];i<e[1]+e[3];i++)for(var f=e[0];f<e[0]+e[2];f++)if(o.hasOwnProperty(f+","+i))var h=v(n[i*w+f]),a=a.a(h,h,h,255);else a=a.a(255,255,255,255);for(n=a,o=O[M][2],e=(180-o)/2,a=(40-n.length/(4*o))/2,d.fillStyle="white",d.fillRect(0,0,180,40),o=d.getImageData(0,0,o,n.length/(4*o)),i=0;i<n.length;i++)o.data[i]=n[i];d.putImageData(o,e,a),M++,setTimeout(t,r,r)}}function r(t,r){var n=t.target.files;if(0<n.length){var e=URL.createObjectURL(n[0]);f(e,function(t,n){if(n>t.length/(4*n)){y=[];for(var a=0;n>a;a++)for(var o=t.length/(4*n)-1;o>=0;o--){var i=4*(o*n+a);y.p(t[i]),y.p(t[i+1]),y.p(t[i+2]),y.p(t[i+3])}w=t.length/(4*n),m=n}else y=t,w=n,m=t.length/(4*n);URL.revokeObjectURL(e),r()})}}function n(t){for(var r=[],n=0;n<t.length;n++)r.p(0);for(var e=[],a=-4;4>=a;a++){e.p([]);for(var o=-4;4>=o;o++)e[a+4].p(.1*Math.exp(-(a*a)/2-o*o/5))}for(n=0;n<t.length;n++)if(0===t[n])for(var i=v(n/w),f=n%w,a=g(i-4,0);a<=l(i+4,m-1);a++)for(o=g(f-4,0);o<=l(f+4,w-1);o++)r[a*w+o]+=4*e[a+4-i][o+4-f];for(n=0;n<r.length;n++)r[n]=.7<r[n]?0:1;return r}function e(t){function r(r){.5>t[r]&&0===n[r]&&(n[r]=a,o.p(r))}for(var n=[],e=0;e<t.length;e++)n.p(0);for(var a=1,e=0;e<t.length;e++)if(0===n[e]&&1!==t[e]){for(var o=[e],i=0;i<o.length;){var f=o[i],h=v(f/w),f=f%w;m>h+1&&r((h+1)*w+f),h-1>=0&&r((h-1)*w+f),f-1>=0&&r(h*w+f-1),w>f+1&&r(h*w+f+1),i++}a++}return n}function a(t,r){var n={};t.r(function(t,e){if(0!==t){var a=e%r,o=v(e/r);n.hasOwnProperty(t)||(n[t]={}),n[t][a+","+o]=!0}});var e,a=[];for(e in n)n.hasOwnProperty(e)&&25<=Object.keys(n[e]).length&&a.p(n[e]);return a}function o(t){return t[1].map(function(r){return r>.75*t[0]?1:0})}function i(t,r,n){for(var e=[],a=0,o=t.length/(4*r),i=0;o>i;i++)for(var f=0;r>f;f++){var h=4*(w*i+f),h=.21*t[h]+.72*t[h+1]+.07*t[h+2];e.p(l(255,v(n*h))),a+=h}return a/=w*m,[a,e]}function f(t,r){var n=new Image;n.onload=function(){t=document.createElement("canvas");t.width=n.width,t.height=n.height,t.style.display="none";var e=t.getContext("2d");e.drawImage(n,0,0,n.width,n.height);for(var a=e.getImageData(0,0,t.width,t.height).data,o=n.height/n.width*720,e=e.getImageData(0,0,720,o).data,t=t.width/720,i=Math.ceil(t),f=0;o>f;f++)for(var h=0;720>h;h++){for(var u=4*(h+720*f),c=0,g=0,l=0,p=0,s=0,d=(f+.5)*t,w=v(f*t);(f+1)*t>w;w++)for(var m=Math.abs(d-(w+.5))/i,y=(h+.5)*t,m=m*m,b=v(h*t);(h+1)*t>b;b++){var I=Math.abs(y-(b+.5))/i,O=Math.sqrt(m+I*I);O>=-1&&1>=O&&(c=2*O*O*O-3*O*O+1,c>0&&(I=4*(b+w*n.width),l+=c*a[I],p+=c*a[I+1],s+=c*a[I+2],g+=c))}e[u]=l/g,e[u+1]=p/g,e[u+2]=s/g,e[u+3]=255}r(e,720)},n.src=t}function h(t){return t.map(function(t,r){var n=1/0,e=n,a=-1/0,o=a;return Object.keys(t).r(function(t){t=t.split(",").map(function(t){return 7(t)}),n=l(n,t[0]),e=l(e,t[1]),a=g(a,t[0]),o=g(o,t[1])}),[n,e,a-n,o-e,r]}).q(function(t){return 4<t[2]})}function u(t){for(var r=[];0<t.length;){var n,e=!1;if(0<r.length){var a=r[r.length-1],o=[];t.r(function(t,r){var n=a[1]+a[3]/2,e=t[1]+t[3]/2,n=n>t[1]&&n<t[1]+t[3];(e>a[1]&&e<a[1]+a[3]||n)&&o.p(t.a(r))}),o=o.q(function(t){var r=t[0]+t[2]/2-(a[0]+a[2]/2);return r>0&&r<t[2]+a[2]}).sort(function(t,r){return t[0]+t[2]/2-(r[0]+r[2]/2)}),0<o.length?n=o[0]:e=!0}else e=!0;e&&(n=t.reduce(function(t,r,n){return t[0]+3*t[1]<r[0]+3*r[1]?t:r.a(n)},[1/0,1/0,1/0,1/0,-1])),r.p(t.splice(n[5],1)[0])}return r}function c(t){return"#"!==t.charAt(0)?!1:document.getElementById(t.substring(1))}v=Math.floor,g=Math.max,l=Math.min,p=Array.prototype;p.p=p.push,p.q=p.filter,p.r=p.forEach,p.a=p.concat;s,d,w,m,y,b,I,O,M;return{b:function(){s=c("#c"),d=s.getContext("2d"),m=w=0,y=[],b=[],I=[],O=[],M=0,c("#d").addEventListener("change",function(f){m=w=0,y=[],b=[],I=[],O=[],M=0,r(f,function(){var r;r=i(y,w,1),r=o(r),I=a(e(n(n(r))),w),O=u(h(I)),b=i(y,w,1.6),t(6e4/7(window.location.hash.substring(1)))})})}}}();window.addEventListener("load",O.b);</script>
